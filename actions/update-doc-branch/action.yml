name: Update documentation branch
description: Generate and push Javadoc to the `doc` branch
inputs:
  project-name:
    description: Project name
    required: true
  keypop-version:
    description: Project version
    required: true
  deploy-type:
    description: Type of deploy (snapshot or release)
    required: true

runs:
  using: "composite"
  steps:
    - name: Run prepare_javadoc.sh
      shell: bash
      run: |
        .github/actions/update-doc-branch/scripts/prepare_javadoc.sh "${{ inputs.project-name }}" "${{ inputs.keypop-version }}" "${{ inputs.deploy-type == 'snapshot' }}"

    - name: Commit and push Javadoc to doc branch
      shell: bash
      working-directory: ${{ inputs.project-name }}
      run: |
        git add -A
        git config user.email "${{ inputs.project-name }}-bot@eclipse.org"
        git config user.name "${{ inputs.project-name }}-bot"
        git commit --allow-empty -m "docs: update documentation $GITHUB_WORKFLOW-$GITHUB_RUN_NUMBER"
        git log --graph --abbrev-commit --date=relative -n 5
        git push "https://${{ secrets.GH_BOT_USERNAME }}:${{ secrets.GH_BOT_TOKEN }}@github.com/eclipse-keypop/${{ inputs.project-name }}.git" HEAD:doc
